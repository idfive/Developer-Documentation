"use strict";(self.webpackChunkidfive_docs=self.webpackChunkidfive_docs||[]).push([[6484],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>v});var n=r(7294);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var c=n.createContext({}),o=function(e){var t=n.useContext(c),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},p=function(e){var t=o(e.components);return n.createElement(c.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,i=e.mdxType,a=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=o(r),m=i,v=u["".concat(c,".").concat(m)]||u[m]||d[m]||a;return r?n.createElement(v,s(s({ref:t},p),{},{components:r})):n.createElement(v,s({ref:t},p))}));function v(e,t){var r=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=r.length,s=new Array(a);s[0]=m;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l[u]="string"==typeof e?e:i,s[1]=l;for(var o=2;o<a;o++)s[o]=r[o];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},8228:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>o});var n=r(7462),i=(r(7294),r(3905));const a={},s="Drupal 8 Services",l={unversionedId:"back-end/drupal/drupal-services",id:"back-end/drupal/drupal-services",title:"Drupal 8 Services",description:'One of the concepts introduced in Drupal 8 is Services. "As a developer, services are used to perform operations like accessing the database, accessing an external API, or sending an e-mail." Drupal Documentation Drupal core provides numerous services for use by developers. For example, Drupal core includes an http client that can be used in modules and injected into services, plugins, or controllers.',source:"@site/docs/back-end/drupal/drupal-services.md",sourceDirName:"back-end/drupal",slug:"/back-end/drupal/drupal-services",permalink:"/docs/back-end/drupal/drupal-services",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/back-end/drupal/drupal-services.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Custom REST endpoints",permalink:"/docs/back-end/drupal/drupal-rest-custom"},next:{title:"Seven to 9 migration locally via lando",permalink:"/docs/back-end/drupal/drupal-seven-migration"}},c={},o=[{value:"services.yml files",id:"servicesyml-files",level:2},{value:"HTTP services.yml example",id:"http-servicesyml-example",level:3},{value:"The PHP class file",id:"the-php-class-file",level:2},{value:"HTTP PHP example",id:"http-php-example",level:3},{value:"Using your new service",id:"using-your-new-service",level:2},{value:"Further knowledge",id:"further-knowledge",level:2}],p={toc:o},u="wrapper";function d(e){let{components:t,...r}=e;return(0,i.kt)(u,(0,n.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"drupal-8-services"},"Drupal 8 Services"),(0,i.kt)("p",null,'One of the concepts introduced in Drupal 8 is Services. "As a developer, services are used to perform operations like accessing the database, accessing an external API, or sending an e-mail." ',(0,i.kt)("a",{parentName:"p",href:"https://www.drupal.org/docs/8/api/services-and-dependency-injection/services-and-dependency-injection-in-drupal-8"},(0,i.kt)("em",{parentName:"a"},"Drupal Documentation"))," Drupal core provides ",(0,i.kt)("a",{parentName:"p",href:"https://api.drupal.org/api/drupal/core%21core.services.yml/8.2.x"},"numerous services")," for use by developers. For example, Drupal core includes an ",(0,i.kt)("a",{parentName:"p",href:"https://api.drupal.org/api/drupal/core%21core.services.yml/service/http_client/8.2.x"},"http client")," that can be used in modules and injected into services, plugins, or controllers."),(0,i.kt)("p",null,"In general, we at idfive prefer to use services for external API calls, or custom DB based calls whenever possible."),(0,i.kt)("p",null,"There are two files necessary for creating a service: a services.yml file and a php file that includes the code providing the service."),(0,i.kt)("h2",{id:"servicesyml-files"},"services.yml files"),(0,i.kt)("p",null,"The services.yml file names and defines the service. The file should be named module_name.services.yml and reside in the module's main directory. The file requires at a minimum service name and a reference to the class that includes the service code."),(0,i.kt)("h3",{id:"http-servicesyml-example"},"HTTP services.yml example"),(0,i.kt)("p",null,"MY_MODULE/MY_MODULE.services.yml:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yml"},"services:\n  MY_CUSTOM_CLIENT.client:\n    class: Drupal\\MY_MODULE\\Services\\MyCustomClientService\n    arguments: ['@http_client']\n")),(0,i.kt)("p",null,"creates a service names 'MY_CUSTOM_CLIENT.client.' The arguments here injects the core Drupal http_client service into this new custom service. Just like any array, multiple arguments can be passed to the service. See the ",(0,i.kt)("a",{parentName:"p",href:"https://www.drupal.org/docs/8/api/services-and-dependency-injection/structure-of-a-service-file"},"Drupal documentation")," for the full list of service properties. The '@' sign here tells Drupal that the argument is a service."),(0,i.kt)("h2",{id:"the-php-class-file"},"The PHP class file"),(0,i.kt)("p",null,"The PHP file containing the code for the service resides in the src/Services directory in the main module directory. In the __construct method of the service, the injected service becomes a property of the class:"),(0,i.kt)("h3",{id:"http-php-example"},"HTTP PHP example"),(0,i.kt)("p",null,"MY_MODULE/src/Services/MyCustomClientService.php:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"class MyCustomClientService\n{\nprotected $client;\n\npublic function __construct(Client $client)\n{\n    $this->client = $client;\n}\n")),(0,i.kt)("p",null,"Then methods can be written to retrieve json data from a REST API, or whatever is needed:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"public function getStuff($num)\n{\n    $url = 'https://MY_API_ENDPOINT.com?limit=' . $num;\n    $stuff = json_decode($this->client->get($url)->getBody()->__toString(), true);\n    return $stuff;\n}\n")),(0,i.kt)("p",null,"Altogether, that looks like the following:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n\nnamespace Drupal\\MY_MODULE;\n\nuse GuzzleHttp\\Client;\n\n/**\n * Class MyCustomClientService.\n */\nclass MyCustomClientService\n{\n    /**\n     * @var GuzzleHttp\\Client\n     */\n    protected $client;\n\n    /**\n     * Constructs a new StarWarsClientService object.\n     */\n    public function __construct(Client $client)\n    {\n        $this->client = $client;\n    }\n\n    /**\n     * Public method to return random set of movies\n     */\n    public function getStuff($num)\n    {\n        $url = 'https://MY_API_ENDPOINT.com?limit=' . $num;\n        $stuff = json_decode($this->client->get($url)->getBody()->__toString(), true);\n        return $stuff;\n    }\n}\n")),(0,i.kt)("h2",{id:"using-your-new-service"},"Using your new service"),(0,i.kt)("p",null,"Once the service is defined and the code in place, instantiating the registered service by passing the static core Drupal service method and calling the included methods:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"$client = \\Drupal::service('MY_CUSTOM_CLIENT.client');\n$stuff = $client->getStuff(3);\n")),(0,i.kt)("h2",{id:"further-knowledge"},"Further knowledge"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"See ",(0,i.kt)("a",{parentName:"li",href:"https://bitbucket.org/idfivellc/idfive-instagram-basic-display-api-service/src/8.x-1.x/"},"idfive Instagram Basic Display API Service")," for a more complex integration, using external libraries/etc.")))}d.isMDXComponent=!0}}]);