"use strict";(self.webpackChunkidfive_docs=self.webpackChunkidfive_docs||[]).push([[322],{4774:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"back-end/drupal/drupal-views","title":"Drupal Views","description":"Best Practices","source":"@site/docs/back-end/drupal/drupal-views.md","sourceDirName":"back-end/drupal","slug":"/back-end/drupal/drupal-views","permalink":"/docs/back-end/drupal/drupal-views","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/back-end/drupal/drupal-views.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Drupal Users and Roles","permalink":"/docs/back-end/drupal/drupal-users-roles"},"next":{"title":"Drupal 8 General Codebase","permalink":"/docs/back-end/drupal/"}}');var t=n(4848),r=n(8453);const l={},a="Drupal Views",o={},d=[{value:"Best Practices",id:"best-practices",level:2},{value:"Typical customizations",id:"typical-customizations",level:2},{value:"General view wrapper template",id:"general-view-wrapper-template",level:2},{value:"Row template",id:"row-template",level:2},{value:"Exposed filters/forms template",id:"exposed-filtersforms-template",level:2},{value:"Exposed filters/forms Advanced JS",id:"exposed-filtersforms-advanced-js",level:2},{value:"General setup",id:"general-setup",level:3},{value:"Module setup",id:"module-setup",level:4},{value:"Example JS file",id:"example-js-file",level:4},{value:"Attaching JS libraries to the views exposed form",id:"attaching-js-libraries-to-the-views-exposed-form",level:4},{value:"Reset button",id:"reset-button",level:3},{value:"SCSS",id:"scss",level:4},{value:"HTML",id:"html",level:4},{value:"JS",id:"js",level:4}];function c(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"drupal-views",children:"Drupal Views"})}),"\n",(0,t.jsx)(s.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Whenever possible, use a rendered entity and display/view mode, rather than individual fields. This will ensure consistency across views within the site."}),"\n",(0,t.jsxs)(s.li,{children:["When overriding ",(0,t.jsx)(s.code,{children:"views-view.html.twig"})," for individual views, ie ",(0,t.jsx)(s.code,{children:"views-view--VIEW-NAME.html.twig"}),", be sure that ",(0,t.jsx)(s.code,{children:"<div{{attributes.addClass(classes)}}>"})," is left in place, as it adds needed classes/etc for lots of stock views operations to work."]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"typical-customizations",children:"Typical customizations"}),"\n",(0,t.jsx)(s.p,{children:"Typically, styling a drupal view will require the following:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"views-view--VIEW-NAME.html.twig"}),": General view wrapper template. Add any general wrapper markup/etc."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"views-view-unformatted--VIEW-NAME.html.twig"}),": Row template. Add per row grid markup/etc here."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"views-exposed-form--VIEW-NAME.html.twig"}),": Exposed filters/form template, if required. Simple exposed forms are often easier to simply style the stock output."]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"general-view-wrapper-template",children:"General view wrapper template"}),"\n",(0,t.jsxs)(s.p,{children:["Sample overridden exposed form, ",(0,t.jsx)(s.code,{children:"views-view--VIEW-NAME.html.twig"}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-twig",children:"{#\n/**\n * @file\n * Theme override of a view.\n *\n * @ingroup themeable\n */\n#}\n\n{%\n  set classes = [\n    'A_CUSTOM_CLASS',\n    dom_id ? 'js-view-dom-id-' ~ dom_id,\n  ]\n%}\n\n<div{{attributes.addClass(classes)}}>\n  <div class=\"exposed_class\">\n    {{ exposed }}\n  </div>\n  {% if rows -%}\n    {{ rows }}\n  {% elseif empty -%}\n    SOME CUSTOM EMPTY MESSAGE/ETC\n  {% endif %}\n  <div class=\"exposed_class\">\n    {{ pager }}\n  </div>\n</div>\n"})}),"\n",(0,t.jsx)(s.h2,{id:"row-template",children:"Row template"}),"\n",(0,t.jsxs)(s.p,{children:["Sample overridden exposed form, ",(0,t.jsx)(s.code,{children:"views-view-unformatted--VIEW-NAME.html.twig"}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-twig",children:'{#\n/**\n * @file\n * Theme override of a view row.\n *\n * @see template_preprocess_views_view_unformatted()\n */\n#}\n\n{% for row in rows %}\n  <div class="row_class">\n    {{ row.content }}\n  </div>\n{% endfor %}\n'})}),"\n",(0,t.jsxs)(s.p,{children:["To note, this is for view list style unformatted, could be applied to formatted/etc if required. ",(0,t.jsx)(s.code,{children:"{{ row.content }}"})," would then be the markup of the specified display mode of the rendered entity, ie teaser/custom/etc."]}),"\n",(0,t.jsx)(s.h2,{id:"exposed-filtersforms-template",children:"Exposed filters/forms template"}),"\n",(0,t.jsxs)(s.p,{children:["Custom exposed filter templates can be created/overridden, via ",(0,t.jsx)(s.code,{children:"views-exposed-form--VIEW-NAME.html.twig"}),". You may then populate individual filters/etc as needed, interspersed with markup."]}),"\n",(0,t.jsxs)(s.p,{children:["The fields themselves are provided by the ",(0,t.jsx)(s.code,{children:"form"})," variable in twig, and can be viewed via ",(0,t.jsx)(s.code,{children:"{{ dump(form)}}"})," in the template. Custom exposed filters are accessed via their 'Filter identifier' in each exposed filters settings, within the view. The 'Filter identifier' is also what shows in the url for each filter when pre-filtering via PHP, as an FYI."]}),"\n",(0,t.jsxs)(s.p,{children:["Sample overridden exposed form, ",(0,t.jsx)(s.code,{children:"views-exposed-form--VIEW-NAME.html.twig"}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-twig",children:"{#\n/**\n * @file\n * Theme override of a views exposed form.\n *\n * Available variables:\n * - form: A render element representing the form.\n *\n * @see template_preprocess_views_exposed_form()\n */\n#}\n\n{% if q is not empty %}\n  {{ q }}\n{% endif %}\n\n<div class=\"some_class\">\n  <div class=\"search_class\">\n    {{ form.search }}\n    {{ form.actions|without('reset') }}\n  </div>\n  <div class=\"filters_class\">\n    <h4>filter by...</h4>\n    {{ form.actions|without('submit') }}\n    {{ form.taxonomy_field }}\n  </div>\n  {{ form|without('search', 'title', 'taxonomy_field', 'actions') }}\n</div>\n"})}),"\n",(0,t.jsx)(s.p,{children:"You can see how markup could then be intermixed into the exposed form. In this instance, we have:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"form.search"}),": A search API fulltext search field, with the Filter identifier of 'search' within the view."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"form.taxonomy_field"}),": An exposed taxonomy select, with the Filter identifier of 'taxonomy_field' within the view."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"{{ form.actions|without('reset') }}"})," can be used to show submit."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"{{ form.actions|without('submit') }}"})," can be used to show reset, if added within view."]}),"\n",(0,t.jsxs)(s.li,{children:["Notice we also render ",(0,t.jsx)(s.code,{children:"form|without"}),", which in this case provides our submit button/etc."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"q"})," markup is needed for cleanurl's, and should be kept in at top of template."]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"exposed-filtersforms-advanced-js",children:"Exposed filters/forms Advanced JS"}),"\n",(0,t.jsx)(s.p,{children:"In lots of situations, we need to then make the custom form more functional. In these cases, we can add JS to target that. The best way to do that is to add js to the exposed form itself, only when needed."}),"\n",(0,t.jsx)(s.h3,{id:"general-setup",children:"General setup"}),"\n",(0,t.jsx)(s.h4,{id:"module-setup",children:"Module setup"}),"\n",(0,t.jsxs)(s.p,{children:["Add any JS (or CSS as well if needed) via libraries to your custom module. The following would set up a general JS and CSS file for use, if they were added in to your module ",(0,t.jsx)(s.code,{children:"as assets/css/MY_MODULE--general.css"})," and ",(0,t.jsx)(s.code,{children:"assets/js/MY_MODULE--general.js"}),"."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yml",children:"MY_JS.general:\n  version: VERSION\n  css:\n     theme:\n       assets/css/MY_MODULE--general.css: {}\n  js:\n    assets/js/MY_MODULE--general.js: {}\n  dependencies:\n    - core/jquery\n    - core/drupalSettings\n"})}),"\n",(0,t.jsx)(s.h4,{id:"example-js-file",children:"Example JS file"}),"\n",(0,t.jsxs)(s.p,{children:["An example ",(0,t.jsx)(s.code,{children:"assets/js/MY_MODULE--general.js"})," as a starter."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:"(function ($) {\n\n  /**\n   * Make selects autosubmit, and a few other functionality additions for views exposed forms.\n   *\n   */\n  Drupal.behaviors.exposedfilter_buttons = {\n    attach: function(context, settings) {\n      // Make selects autosubmit\n      $('.views-exposed-form .js-form-item input').on('change', function(e) {\n        var form = $(this).parents('form:first').attr('id');\n        $('#' + form + ' input.form-submit').trigger('click');\n      });\n\n      // Custom reset button\n      $('.custom-search--reset').on('click', function(e) {\n        location.reload();\n      });\n\n      // If we passed parameters to prefilter(like ?taxonomy_term[37]=37), remove from url now.\n      var url = location.href;\n      if (url.match(/\\?./)) {\n        var newURL = url.split(\"?\")[0];\n        window.history.pushState('object', document.title, newURL);\n      }\n\n    }\n  };\n\n})(jQuery);\n"})}),"\n",(0,t.jsx)(s.h4,{id:"attaching-js-libraries-to-the-views-exposed-form",children:"Attaching JS libraries to the views exposed form"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-php",children:"/**\n   * Implements hook_form_FORM_ID_alter().\n   *\n   * Adds JS to all exposed forms.\n   */\nfunction MY_MODULE_form_views_exposed_form_alter(&$form, FormStateInterface $form_state, $form_id) {\n  $form['#attached']['library'][] = 'MY_MODULE/MY_JS.general';\n}\n"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-php",children:"/**\n   * Implements hook_form_FORM_ID_alter().\n   *\n   * Adds JS.\n   */\nfunction MY_MODULE_form_views_exposed_form_alter(&$form, FormStateInterface $form_state, $form_id) {\n  // Add a specific JS file for one view, general to all others.\n  if ($form['#id'] == 'SPECIFIC_FORM_ID_OF_WHATEVER_VIEW_YOU_WANT') {\n    $form['#attached']['library'][] = 'MY_MODULE/MY_JS.specific';\n  } else {\n    $form['#attached']['library'][] = 'MY_MODULE/MY_JS.general';\n  }\n}\n"})}),"\n",(0,t.jsx)(s.h3,{id:"reset-button",children:"Reset button"}),"\n",(0,t.jsx)(s.p,{children:'Most times, it is easier to create a custom reset button, that simply reloads the page, rather than attempting to integrate the views reset, which has some issues. In that way, you can also place it wherever you wish within the exposed form. When ajax is used, one of your views wrappers will receive an "initialized" class. By targeting that, we can also hide it by default.'}),"\n",(0,t.jsx)(s.h4,{id:"scss",children:"SCSS"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-scss",children:".cua--view-reset {\n    display: none;\n}\n\n.cua--view-reset.initialized {\n    display: block;\n}\n"})}),"\n",(0,t.jsx)(s.h4,{id:"html",children:"HTML"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-html",children:'<a href="#" onclick="window.location.reload(true);" class="cua--view-reset">Reset Filters</a>\n'})}),"\n",(0,t.jsx)(s.h4,{id:"js",children:"JS"}),"\n",(0,t.jsx)(s.p,{children:"To be added in to your attached JS lib."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:"(function ($) {\n\n    /**\n     * Make reset buttons appear for all views that utilize.\n     *\n     */\n\n    Drupal.behaviors.myCustomModule = {\n        attach: function(context, settings) {\n\n          // RReset button\n          $(document).on('ajaxComplete', function(event, xhr, settings) {\n            var url = settings.url.split('?')[0];\n            url = url.toString();\n            console.log(url);\n            if (url == '/views/ajax') {\n                $('.cua--view-reset').addClass('initialized');\n            }\n          });\n\n        }\n      };\n\n})(jQuery);\n"})})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>a});var i=n(6540);const t={},r=i.createContext(t);function l(e){const s=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:s},e.children)}}}]);