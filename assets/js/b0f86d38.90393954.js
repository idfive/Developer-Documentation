"use strict";(self.webpackChunkidfive_docs=self.webpackChunkidfive_docs||[]).push([[7291],{3905:(e,n,a)=>{a.d(n,{Zo:()=>p,kt:()=>m});var r=a(7294);function t(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function o(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,r)}return a}function l(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?o(Object(a),!0).forEach((function(n){t(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function i(e,n){if(null==e)return{};var a,r,t=function(e,n){if(null==e)return{};var a,r,t={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],n.indexOf(a)>=0||(t[a]=e[a]);return t}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(t[a]=e[a])}return t}var c=r.createContext({}),s=function(e){var n=r.useContext(c),a=n;return e&&(a="function"==typeof e?e(n):l(l({},n),e)),a},p=function(e){var n=s(e.components);return r.createElement(c.Provider,{value:n},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},h=r.forwardRef((function(e,n){var a=e.components,t=e.mdxType,o=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=s(a),h=t,m=u["".concat(c,".").concat(h)]||u[h]||d[h]||o;return a?r.createElement(m,l(l({ref:n},p),{},{components:a})):r.createElement(m,l({ref:n},p))}));function m(e,n){var a=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var o=a.length,l=new Array(o);l[0]=h;var i={};for(var c in n)hasOwnProperty.call(n,c)&&(i[c]=n[c]);i.originalType=e,i[u]="string"==typeof e?e:t,l[1]=i;for(var s=2;s<o;s++)l[s]=a[s];return r.createElement.apply(null,l)}return r.createElement.apply(null,a)}h.displayName="MDXCreateElement"},6443:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>s});var r=a(7462),t=(a(7294),a(3905));const o={},l="Caching in drupal",i={unversionedId:"back-end/drupal/drupal-caching",id:"back-end/drupal/drupal-caching",title:"Caching in drupal",description:"It is important to remember that, there are many, many, levels of caching on a modern drupal site. Specifics will depend on what server/environment sites are on, as well, as the content within.",source:"@site/docs/back-end/drupal/drupal-caching.md",sourceDirName:"back-end/drupal",slug:"/back-end/drupal/drupal-caching",permalink:"/docs/back-end/drupal/drupal-caching",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/back-end/drupal/drupal-caching.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Drupal",permalink:"/docs/category/drupal"},next:{title:"Configuration Management",permalink:"/docs/back-end/drupal/drupal-config-management"}},c={},s=[{value:"idfive&#39;s baseline D8/9 setup",id:"idfives-baseline-d89-setup",level:2},{value:"Fire bazooka",id:"fire-bazooka",level:2},{value:"Custom external cache clearing, on cron or similar",id:"custom-external-cache-clearing-on-cron-or-similar",level:2}],p={toc:s},u="wrapper";function d(e){let{components:n,...a}=e;return(0,t.kt)(u,(0,r.Z)({},p,a,{components:n,mdxType:"MDXLayout"}),(0,t.kt)("h1",{id:"caching-in-drupal"},"Caching in drupal"),(0,t.kt)("p",null,"It is important to remember that, there are many, many, levels of caching on a modern drupal site. Specifics will depend on what server/environment sites are on, as well, as the content within."),(0,t.kt)("h2",{id:"idfives-baseline-d89-setup"},"idfive's baseline D8/9 setup"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},'Disable "Internal Page Cache" module. There are several ',(0,t.kt)("a",{parentName:"li",href:"https://www.drupal.org/project/drupal/issues/2352009"},"core issues")," with this at the time of writing."),(0,t.kt)("li",{parentName:"ul"},"Set up specific scheduled jobs, if required, to clear caches (",(0,t.kt)("inlineCode",{parentName:"li"},"drush cr")," or similar) on a timed basis.")),(0,t.kt)("h2",{id:"fire-bazooka"},"Fire bazooka"),(0,t.kt)("p",null,"For some things, like seldom seen admin pages/etc, it may make sense to kill caching entirely. In these cases, you may trigger the cache kill switch. Calling the kill switch will stop both the page cache and the dynamic page cache from doing any caching on that page."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-php"},"\\Drupal::service('page_cache_kill_switch')->trigger();\n")),(0,t.kt)("h2",{id:"custom-external-cache-clearing-on-cron-or-similar"},"Custom external cache clearing, on cron or similar"),(0,t.kt)("p",null,'Lots of times, we load external content into KS paragraphs. This means, that the content itself gets cached for anonymous users. Since this is sometimes timely info, ie events, news, etc, we need to clear, or invalidate those caches periodically. Running a sitewide cache clear definitely works, however for larger sites this can result in performance issues. A better approach, is to define which paragraphs are external content, and simply invalidate those caches on cron run. This should then "bubble up" to the page cache, just as if you had saved new content into these paragraphs/etc.'),(0,t.kt)("p",null,"First create a custom controller, such as ",(0,t.kt)("inlineCode",{parentName:"p"},"MY_MODULE/src/Controller/MyExternalController.php"),"."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-php"},"namespace Drupal\\MY_MODULE\\Controller;\n\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\paragraphs\\Entity\\Paragraph;\nuse Drupal\\Core\\Cache\\Cache;\n\n/**\n * Controller that helps load and clear external content feed caches for websites.\n */\nclass MyExternalController extends ControllerBase {\n  /**\n   * Gets paragraphs that contain external content feeds.\n   */\n  public static function clearExternalContent() {\n    $query = \\Drupal::entityQuery('paragraph')\n    ->condition('type', [\n      'my_external_content_paragraph_1',\n      'my_external_content_paragraph_2',\n      'my_external_content_paragraph_3',\n    ], 'IN');\n    $pids = $query->execute();\n    $cids = [];\n    foreach ($pids as $key => $pid) {\n      $paragraph = Paragraph::load($pid);\n      $tags = $paragraph->getCacheTags();\n      $cids[] = $tags;\n      Cache::invalidateTags($tags);\n\n    }\n    $message = 'External content feed caches cleared.';\n    \\Drupal::logger('MY_MODULE')->notice($message);\n    return $cids;\n  }\n}\n")),(0,t.kt)("p",null,"Then create a ",(0,t.kt)("inlineCode",{parentName:"p"},"hook_cron()")," in ",(0,t.kt)("inlineCode",{parentName:"p"},"MY_MODULE.module"),"."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-php"},"\nuse Drupal\\MY_MODULE\\Controller\\MyExternalController;\n\n/**\n * Implements hook_cron().\n *\n * We implement hook_cron() to kick off clearing caches on external feed paragraphs.\n *\n */\nfunction MY_MODULE_cron() {\n  // Load and clear cache for all paragraphs marked as external.\n  MyExternalController::clearExternalContent();\n}\n")))}d.isMDXComponent=!0}}]);