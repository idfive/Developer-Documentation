"use strict";(self.webpackChunkidfive_docs=self.webpackChunkidfive_docs||[]).push([[1262],{8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>r});var i=t(6540);const a={},s=i.createContext(a);function l(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),i.createElement(s.Provider,{value:n},e.children)}},9615:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"back-end/drupal/drupal-custom-development","title":"Drupal Custom Development","description":"Custom module and theme development patterns and best practices for Drupal","source":"@site/docs/back-end/drupal/drupal-custom-development.md","sourceDirName":"back-end/drupal","slug":"/back-end/drupal/drupal-custom-development","permalink":"/docs/back-end/drupal/drupal-custom-development","draft":false,"unlisted":false,"editUrl":"https://github.com/idfive/Developer-Documentation/tree/main/docs/back-end/drupal/drupal-custom-development.md","tags":[],"version":"current","frontMatter":{"description":"Custom module and theme development patterns and best practices for Drupal"},"sidebar":"tutorialSidebar","previous":{"title":"Drupal Content Architecture","permalink":"/docs/back-end/drupal/drupal-content-architecture"},"next":{"title":"Drupal Deployment Standards","permalink":"/docs/back-end/drupal/drupal-deployment-standards"}}');var a=t(4848),s=t(8453);const l={description:"Custom module and theme development patterns and best practices for Drupal"},r="Drupal Custom Development",o={},d=[{value:"Theme/Module Best Practices",id:"thememodule-best-practices",level:2},{value:"Admin UX",id:"admin-ux",level:3},{value:"Help Text",id:"help-text",level:3},{value:"Hook_help example",id:"hook_help-example",level:4},{value:"Hook_field_WIDGET_TYPE_paragraphs_form_alter",id:"hook_field_widget_type_paragraphs_form_alter",level:4},{value:"Libraries",id:"libraries",level:2},{value:"Global, via a .info.yml",id:"global-via-a-infoyml",level:3},{value:"Via a hook_preprocess",id:"via-a-hook_preprocess",level:3},{value:"In twig template",id:"in-twig-template",level:3},{value:"JavaScript Variables from the Server",id:"javascript-variables-from-the-server",level:2},{value:"View Modes",id:"view-modes",level:2},{value:"Adding view modes",id:"adding-view-modes",level:3},{value:"View mode templates",id:"view-mode-templates",level:3},{value:"Regions and Blocks",id:"regions-and-blocks",level:2},{value:"Scoping",id:"scoping",level:2},{value:"Fields",id:"fields",level:3},{value:"Functions",id:"functions",level:3},{value:"Variables",id:"variables",level:3},{value:"Metatags",id:"metatags",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"drupal-custom-development",children:"Drupal Custom Development"})}),"\n",(0,a.jsx)(n.h2,{id:"thememodule-best-practices",children:"Theme/Module Best Practices"}),"\n",(0,a.jsx)(n.h3,{id:"admin-ux",children:"Admin UX"}),"\n",(0,a.jsx)(n.p,{children:"When adding/arranging fields on entities and forms, give careful consideration to how things are ordered/labeled/layed out. It is extremely important that the admin UX be as clean, and straightforward as possible for admins to use the site effectively."}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Consider using field groups in display to group fields into collapsed details/fieldsets."}),"\n",(0,a.jsx)(n.li,{children:"Consider setting up tabs for large, complex entities, with the tabs corresponding to naming seen on frontend sections."}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"help-text",children:"Help Text"}),"\n",(0,a.jsx)(n.p,{children:"Help text is normally aimed at admins and site builders, and is necessary to provide a great admin experience. It is easy to overlook this, but it is the key to providing a great admin experience, and sometimes even for developers to more readily understand what is going on when revisiting older projects."}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["All custom modules should, at a minimum utilize a ",(0,a.jsx)(n.code,{children:"hook_help()"})," to show the modules (properly formatted) README.md."]}),"\n",(0,a.jsx)(n.li,{children:"Consider adding help text/etc to entity add/edit forms to explain how things work, and best practices."}),"\n",(0,a.jsx)(n.li,{children:'Consider adding markup fields to entities (like a homepage) to explain how things "not controlled within the form" work, like feeds from views and external API\'s. For example: "The blogs feed displays the 3 most recent blog posts tagged with X".'}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://www.drupal.org/docs/develop/documenting-your-project/help-text-standards",children:"drupal help text standards"})}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"hook_help-example",children:"Hook_help example"}),"\n",(0,a.jsx)(n.p,{children:"Displays the README.md as for the help page of a module. Loads markdown module for better formatting if present."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"<?php\n\n/**\n * @file\n * My custom module file.\n */\n\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\n\n/**\n * Implements hook_help().\n *\n * @inheritdoc\n */\nfunction MY_MODULE_help($route_name, RouteMatchInterface $route_match) {\n  switch ($route_name) {\n    case 'help.page.MY_MODULE':\n      $text = file_get_contents(dirname(__FILE__) . \"/README.md\");\n      if (!\\Drupal::moduleHandler()->moduleExists('markdown')) {\n        return '<pre>' . $text . '</pre>';\n      }\n      else {\n        // Use the Markdown filter to render the README.\n        $filter_manager = \\Drupal::service('plugin.manager.filter');\n        $settings = \\Drupal::configFactory()->get('markdown.settings')->getRawData();\n        $config = ['settings' => $settings];\n        $filter = $filter_manager->createInstance('markdown', $config);\n        return $filter->process($text, 'en');\n      }\n  }\n  return NULL;\n}\n"})}),"\n",(0,a.jsx)(n.h4,{id:"hook_field_widget_type_paragraphs_form_alter",children:"Hook_field_WIDGET_TYPE_paragraphs_form_alter"}),"\n",(0,a.jsx)(n.p,{children:"Provides customized help text for a custom paragraphs module, so that you may point clients in the right direction and provide tips, best practices, and context. To note the following only works with the new paragraphs display, if using legacy, you will need to change to the appropriate widget type in the following hook."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"/**\n * Implements hook_field_WIDGET_TYPE_paragraphs_form_alter().\n *\n * Adds helper text to the paragraph.\n */\nfunction MY_MODULE_field_widget_paragraphs_form_alter(&$element, &$form_state, $context) {\n  if ($element['#paragraph_type'] == 'MY_PARAGRAPH') {\n    // Tips text from idfive.\n    $markup = '<h3>Do:</h3><ul>';\n    $markup .= '<li><strong>Use blockquotes to break up long copy.</strong> A brief quote can provide visual interest and offset larger text blocks.</li>';\n    $markup .= '<li><strong>Use plain text.</strong> Avoid including links or other styled elements.</li>';\n    $markup .= '</ul>';\n    $markup .= '<h3>Do Not:</h3><ul>';\n    $markup .= '<li><strong>Use an overly long quote.</strong> Often block quotes use font sizes/weights that can be overwhelming if used for copy that is very long.</li>';\n    $markup .= '<li><strong>Place a blockquote as the last element on the page.</strong></li>';\n    $markup .= '</ul>';\n    $markup .= '<p><a target=\"_blank\" href=\"/admin/help/MY_MODULE\">My Module Help</a></p>';\n    $element['MY_PARAGRAPH_tips'] = [\n      '#type' => 'details',\n      '#title' => t('MY_PARAGRAPH Content Tips'),\n      '#weight' => -1000,\n    ];\n    $element['MY_PARAGRAPH_tips']['#markup'] = $markup;\n  }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"libraries",children:"Libraries"}),"\n",(0,a.jsx)(n.p,{children:"Most times, any custom css/js should be attached globally. There are a few instances where this may not be desirable, for instance if there were extremely large css/js files that only ran one specific function on specific pages, like a homepage."}),"\n",(0,a.jsx)(n.h3,{id:"global-via-a-infoyml",children:"Global, via a .info.yml"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yml",children:"name: MY_THEME\ntype: theme\ndescription: An amazingly awesome theme I just built.\ncore: 8.x\nlibraries:\n  - MY_THEME/something-homepage-specific\n"})}),"\n",(0,a.jsx)(n.h3,{id:"via-a-hook_preprocess",children:"Via a hook_preprocess"}),"\n",(0,a.jsx)(n.p,{children:"Choose this if you want to add to pages of multiple, types, maybe based on a URL path or the like."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"function MY_THEME_preprocess_page(&$variables) {\n  // Example of a check here, for front page, but could be anything.\n  if ($variables['is_front'] == TRUE) {\n    $variables['#attached']['library'][] = 'MY_THEME/something-homepage-specific';\n  }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"in-twig-template",children:"In twig template"}),"\n",(0,a.jsx)(n.p,{children:"Use this if the library in question is only needed on this particular template, and no others. Specifically helpful for things like custom paragraphs."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-twig",children:"{# only attach our library if this is node 1 #}\n{% if node.id == 1 %}\n  {{ attach_library('MY_THEME/something-homepage-specific') }}\n{% endif %}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"javascript-variables-from-the-server",children:"JavaScript Variables from the Server"}),"\n",(0,a.jsx)(n.p,{children:"Pass a dynamic value from the server (PHP) to client-side JavaScript using the drupalSettings library. Sometimes this is needed in order for some custom JS to run, but in general, shy away if possible."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"function MY_THEME_page_attachments_alter(array &$page) {\n  // We're going to pass along the user's display name to our front-end code.\n  $account = \\Drupal::currentUser();\n  if ($account->isAuthenticated()) {\n    $page['#attached']['library'][] = 'MY_THEME/my-custom-js';\n    // We pass along our dynamic value.\n    // This will then be available in our JavaScript as drupalSettings.friendly.name.\n    $page['#attached']['drupalSettings']['MY_THEME']['name'] = $account->getDisplayName();\n  }\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["In this case ",(0,a.jsx)(n.code,{children:"drupalSettings.MY_THEME.name"})," will now be available to the JavaScript file in our asset library."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"(function (Drupal) {\n  if (drupalSettings.MY_THEME.name) {\n    var siteName = document.getElementsByClassName('site-branding__name')[0];\n    siteName.getElementsByTagName('a')[0].innerHTML = '<h1>Howdy, ' + drupalSettings.MY_THEME.name + '!</h1>';\n  }\n})(Drupal);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"view-modes",children:"View Modes"}),"\n",(0,a.jsx)(n.p,{children:"How an entity (such as content, a user , etc) is displayed, depends on the context in which it is shown. This context is known as a view mode. Examples of view modes for one content type (article) is:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Full article"}),"\n",(0,a.jsx)(n.li,{children:"Teaser article view"}),"\n",(0,a.jsx)(n.li,{children:"Card article view"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:'The main idea being, in combined views of content, you can now say "show me 3 articles that match XYZ, and display as cards". Now, when using  things like views, we don\'t need to customize the output, we simply tell it which view mode to display.'}),"\n",(0,a.jsx)(n.h3,{id:"adding-view-modes",children:"Adding view modes"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["View modes can be added ",(0,a.jsx)(n.code,{children:"/admin/structure/display-modes/view"}),'. Ideally, the names should span content types, so that something like a "card view" can be used for articles, events, etc.']}),"\n",(0,a.jsxs)(n.li,{children:["On ",(0,a.jsx)(n.code,{children:"/admin/structure/types/manage/MY_ENTITY/display"}),', under "custom display settings", choose the desired view modes.']}),"\n",(0,a.jsx)(n.li,{children:"Configure the display of each view mode, for each desired entity."}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"view-mode-templates",children:"View mode templates"}),"\n",(0,a.jsxs)(n.p,{children:["Each view mode can get its own template within the theme. Generally, we prefer to group them by entity and bundle, so that all view modes for a particular entity/bundle are in the same folder within the theme. The naming convention is ",(0,a.jsx)(n.code,{children:"ENTITY--BUNDLE--VIEW-MODE.html.twig"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"templates\n  node\n    NODE-TYPE\n      node--NODE-TYPE--card.html.twig\n      node--NODE-TYPE--teaser.html.twig\n      node--NODE-TYPE.html.twig\n"})}),"\n",(0,a.jsx)(n.h2,{id:"regions-and-blocks",children:"Regions and Blocks"}),"\n",(0,a.jsx)(n.p,{children:"In general, we prefer not to use blocks excessively in drupal sites. The blocks we generally use, are limited mainly to:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Menu Blocks"}),"\n",(0,a.jsx)(n.li,{children:"Breadcrumbs"}),"\n",(0,a.jsx)(n.li,{children:"Main Content"}),"\n",(0,a.jsx)(n.li,{children:"Messages"}),"\n",(0,a.jsx)(n.li,{children:"Admin tabs (though the admin menu edit tab mods in the idfive theme mainly eliminate this need)"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"We find that setting custom content (views/lists/related articles/etc) is better accomplished at the entity_preprocess level, and added to the templates, per entity type, where needed, rather than relying on lots of blocks."}),"\n",(0,a.jsxs)(n.p,{children:["With that in mind, since regions are mainly to hold blocks, regions within the theme are usually created in regards to where breadcrumbs, or menus need to be. As an example, the following regions are set in the ",(0,a.jsx)(n.a,{href:"https://bitbucket.org/idfivellc/idfive-component-library-d8-theme",children:"idfive base theme"}),", and are a good example:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"primary_menu: 'Primary menu'"}),"\n",(0,a.jsx)(n.li,{children:"secondary_menu: 'Secondary menu'"}),"\n",(0,a.jsx)(n.li,{children:"utility_menu: 'Utility menu'"}),"\n",(0,a.jsx)(n.li,{children:"breadcrumbs: 'Breadcrumbs'"}),"\n",(0,a.jsx)(n.li,{children:"page_sidebar: 'Page Sidebar'"}),"\n",(0,a.jsx)(n.li,{children:"content: 'Content'"}),"\n",(0,a.jsx)(n.li,{children:"footer_menu: 'Footer menu'"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["It is also worth noting, that the ",(0,a.jsx)(n.a,{href:"https://bitbucket.org/idfivellc/idfive-component-library-d8-theme",children:"idfive base theme"})," includes preprocess functions to make these regions available to the node template as well, so things like the sidebar, can be added in the node template, rather than page template, to simplify design ingestion."]}),"\n",(0,a.jsx)(n.h2,{id:"scoping",children:"Scoping"}),"\n",(0,a.jsx)(n.p,{children:"In general, we want to scope most custom elements to the parent theme/module/etc, to include, but not limited to:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Fields"}),"\n",(0,a.jsx)(n.li,{children:"Functions"}),"\n",(0,a.jsx)(n.li,{children:"Variables"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"fields",children:"Fields"}),"\n",(0,a.jsx)(n.p,{children:'Fields should be scoped to the controlling entity. Fields can be shared in certain instances (like between sub-modules), but in that instance would be scoped to the parent module.\nFor example, a text field used by the "CLIENT Paragraphs" module, could be scoped as machine names:'}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"field_cp_text"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"cp_text"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"client_paragraphs_text"})}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"functions",children:"Functions"}),"\n",(0,a.jsx)(n.p,{children:'Custom functions belonging to modules or themes should be scoped as "underscore + module/theme name + description".\nFor example, custom functions in the "CLIENT Paragraphs" module, could be scoped as:'}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"_client_paragraphs_format_into_list"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"_client_paragraphs_get_external_news"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"_client_paragraphs_get_external_events"})}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"variables",children:"Variables"}),"\n",(0,a.jsx)(n.p,{children:"Custom variables should be scoped to the module/theme that creates them, and the entity that uses them.\nFor example, if I were getting a list of events for the homepage, my variable for that could be scoped as:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"cp_homepage_events"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"client_paragraphs_events_for_homepage"})}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"metatags",children:"Metatags"}),"\n",(0,a.jsxs)(n.p,{children:["Default metatags (from the metatags module) are usually fine. One caveat is the og",":image"," tag."]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Consider adding a default social share image for the entire site."}),"\n",(0,a.jsx)(n.li,{children:"Consider overriding that, or adding to, for content like news and events."}),"\n",(0,a.jsxs)(n.li,{children:["Since we use media module, utilize a token within the og",":image"," metatag, like: ",(0,a.jsx)(n.code,{children:"[node:MEDIA_FIELD_ON_NODE:entity:field_media_image:DESIRED_IMAGE_STYLE:url]"})]}),"\n",(0,a.jsx)(n.li,{children:"Multiple images may be added in this field, and the particular service (twitter/facebook/etc) will choose the one it wants, usually the largest. For this reason, be sure the chosen image style of the media field is physically larger than the site default share image."}),"\n",(0,a.jsxs)(n.li,{children:["A complete example for the og",":image"," metatag field, could look like: ",(0,a.jsx)(n.code,{children:"/themes/custom/MY_AWESOME_THEME/social/MY_AWESOME_SOCIAL_SHARE_DEFAULT.jpg, [node:field_featured_image:entity:field_media_image:large:url]"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs/back-end/drupal/drupal-sitebuilding",children:"Drupal Site Building"})," - Core site building practices"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs/back-end/drupal/drupal-content-architecture",children:"Drupal Content Architecture"})," - Views, queries, and content patterns"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs/back-end/drupal/drupal-media-images",children:"Drupal Media & Images"})," - Media handling and image optimization"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs/back-end/drupal/drupal-deployment-standards",children:"Drupal Deployment Standards"})," - Launch preparation and code quality"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}}}]);